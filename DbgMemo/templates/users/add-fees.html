{% extends 'users/base.html' %}

{% block content %}

<title>DbgMemO - PAGE DE PAIEMENTS</title>

<div class="content-body">
    <div class="container-fluid">
        <div class="row page-titles mx-0">
            <div class="col-sm-6 p-md-0">
                <div class="welcome-text">
                    <h4>Création de Paiements > {{ etudiant.nom }} {{ etudiant.prenom }}</h4>
                </div>
            </div>
            <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="javascript:void(0);">Paiement</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0);">Création</a></li>
                </ol>
            </div>
        </div>

        <div class="row">
            <div class="col-xl-12 col-xxl-12 col-sm-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Ajouter un paiement > {{ etudiant.nom }} {{ etudiant.prenom }}</h5>
                    </div>
                    <div class="card-body">
                        <form action="#" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                        
                            <div class="row">
                                <!-- Frais d'impression (remplace montant) -->
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        {{ form.frais_impression.label_tag }}
                                        {{ form.frais_impression }}
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        {{ form.commission.label_tag }}
                                        {{ form.commission }}
                                    </div>
                                </div>
                                
                                <!-- Source de paiement -->
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        {{ form.source.label_tag }}
                                        {{ form.source }}
                                    </div>
                                </div>
                                                               
                                <!-- Référence de paiement -->
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        {{ form.reference_paiement.label_tag }}
                                        {{ form.reference_paiement }}
                                    </div>
                                </div>
                                
                                <!-- Service annexe - même style que le statut -->
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>{{ form.service_annexe.label }}</label>
                                        <div class="form-check">
                                            {{ form.service_annexe }}
                                            <label class="form-check-label" for="{{ form.service_annexe.id_for_label }}">
                                                Cocher si applicable
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Frais annexe (masqué par défaut) -->
                                <div class="col-sm-6" id="frais-annexe-group" style="display:none;">
                                    <div class="form-group">
                                        {{ form.frais_annexe.label_tag }}
                                        {{ form.frais_annexe }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.intitule_annexe.label_tag }}
                                        {{ form.intitule_annexe }}
                                    </div>
                                </div>
                                
                                <!-- Montant total calculé -->
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Montant Total</label>
                                        <input type="text" class="form-control" 
                                               id="montant-total" 
                                               value="0 FCFA" 
                                               readonly>
                                    </div>
                                </div>

                                <div class="form-check">
                                    {{ form.statut.label_tag }}
                                    {{ form.statut }}
                                </div>
                            </div>
                            
                            <div class="col-sm-6">
                                <p></p>
                                <p></p>
                            </div>
                            
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <button type="submit" class="btn btn-primary">Valider</button>
                                <button type="reset" class="btn btn-danger light">Actualiser</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<script>
    // Afficher/masquer le champ frais_annexe selon service_annexe
    document.getElementById('{{ form.service_annexe.id_for_label }}').addEventListener('change', function() {
        const fraisAnnexeGroup = document.getElementById('frais-annexe-group');
        fraisAnnexeGroup.style.display = this.checked ? 'block' : 'none';
        if (!this.checked) {
            document.getElementById('{{ form.frais_annexe.id_for_label }}').value = '0';
        }
        calculateTotal();
    });
    
    // Calcul automatique du montant total
    function calculateTotal() {
        const fraisImpression = parseFloat(document.getElementById('{{ form.frais_impression.id_for_label }}').value) || 0;
        const serviceAnnexe = document.getElementById('{{ form.service_annexe.id_for_label }}').checked;
        const fraisAnnexe = serviceAnnexe ? (parseFloat(document.getElementById('{{ form.frais_annexe.id_for_label }}').value) || 0) : 0;
        
        const total = fraisImpression + fraisAnnexe;
        document.getElementById('montant-total').value = total.toFixed(2) + ' FCFA';
    }
    
    // Écouteurs pour le calcul automatique
    document.getElementById('{{ form.frais_impression.id_for_label }}').addEventListener('input', calculateTotal);
    document.getElementById('{{ form.frais_annexe.id_for_label }}').addEventListener('input', calculateTotal);
    
    // Initialisation au chargement
    window.addEventListener('DOMContentLoaded', function() {
        calculateTotal();
        if (document.getElementById('{{ form.service_annexe.id_for_label }}').checked) {
            document.getElementById('frais-annexe-group').style.display = 'block';
        }
    });
</script>




<script>
function updateAnnexeFrais(select) {
    // Cette fonction pourrait mettre à jour un champ caché ou un affichage
    // des frais annexes en fonction du choix (optionnel)
    const selectedOption = select.options[select.selectedIndex];
    console.log("Service annexe sélectionné:", selectedOption.value);
}

function toggleAnnexeFields(checkbox) {
    const annexeFields = document.getElementById('annexe-fields');
    if (checkbox.checked) {
        annexeFields.style.display = 'block';
    } else {
        annexeFields.style.display = 'none';
    }
}
</script>
    

{% endblock %}